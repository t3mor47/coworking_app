<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Queue / Cola</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 500px; margin: 50px auto; }
    label { display: block; margin-top: 15px; }
    input { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 15px; padding: 10px 20px; }
    p { margin-top: 20px; font-weight: bold; }
    select { padding: 6px; font-size: 15px; }
    option { padding: 4px; }
  </style>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body { overflow: hidden !important; margin: 0; padding: 0; font-size:16px; }
  #queueForm { display:flex; flex-direction:column; justify-content:center; align-items:center; margin:0 auto; max-width:95vw; }
  input, select, button { width:90vw; max-width:300px; padding:12px; font-size:16px; margin-top:8px; box-sizing:border-box; }
</style>
</head>
<body style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;">
  <h1 id="title"></h1>

  <label for="language">üåê</label>
  <select id="language">
    <option value="es">üá™üá∏ Espa√±ol</option>
    <option value="en">üá¨üáß English</option>
    <option value="ar">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
    <option value="it">üáÆüáπ Italiano</option>
    <option value="fr">üá´üá∑ Fran√ßais</option>
    <option value="de">üá©üá™ Deutsch</option>
    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
    <option value="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
  </select>

  <form id="queueForm">
    <label id="labelName"></label>
    <input type="text" id="name" required>

    <label id="labelCode"></label>
    <input type="text" id="club_code" required>

    <button type="submit" id="joinBtn"></button>
<button type="button" id="refreshBtn"></button>
</form>

  <p id="position"></p>
  <p id="message"></p>

  <script>
  let deviceId = getDeviceId();
    const form = document.getElementById('queueForm');
    const positionEl = document.getElementById('position');
    const messageEl = document.getElementById('message');
    const languageSelect = document.getElementById('language');
    const joinBtn = document.getElementById('joinBtn');
    const nameInput = document.getElementById('name');
    const codeInput = document.getElementById('club_code');

const texts = {
  ar: { title: "ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ ÿßŸÑÿ∑ÿßÿ®Ÿàÿ±", name: "ÿßŸÑÿßÿ≥ŸÖ / ÿßŸÑŸÑŸÇÿ®:", code: "ÿ±ŸÖÿ≤ ÿßŸÑŸÜÿßÿØŸä:", join: "ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ ÿßŸÑÿ∑ÿßÿ®Ÿàÿ±", pos: "ŸÖŸàŸÇÿπŸÉ: ", refresh: "ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸàŸÇÿπ", error: "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿßÿ≥ŸÖ ŸàÿßŸÑÿ±ŸÖÿ≤.", closed: "ÿßŸÑÿ∑ÿßÿ®Ÿàÿ± ŸÖÿ∫ŸÑŸÇ. ÿßŸÑÿ≥ÿßÿπÿßÿ™: 11:00‚Äì23:00." },
  es: { title: "Unirse a la cola", name: "Nombre / Apodo:", code: "C√≥digo del club:", join: "Unirse a la cola", pos: "Tu posici√≥n: ", refresh: "Actualizar posici√≥n", error: "Por favor, ingresa tu nombre y c√≥digo.", closed: "La cola est√° cerrada. Horario: 11:00‚Äì23:00." },
  en: { title: "Join the queue", name: "Name / Nickname:", code: "Club code:", join: "Join the queue", pos: "Your position: ", refresh: "Refresh position", error: "Please enter your name and code.", closed: "Queue is closed. Working hours: 11:00‚Äì23:00." },
  de: { title: "Der Warteschlange beitreten", name: "Name / Spitzname:", code: "Club-Code:", join: "Beitreten", pos: "Deine Position: ", refresh: "Position aktualisieren", error: "Bitte Name und Code eingeben.", closed: "Die Warteschlange ist geschlossen. Zeiten: 11:00‚Äì23:00." },
  ru: { title: "–í—Å—Ç–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å", name: "–ò–º—è / –ù–∏–∫:", code: "–ö–æ–¥ –∫–ª—É–±–∞:", join: "–í—Å—Ç–∞—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å", pos: "–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è: ", refresh: "–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é", error: "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –∫–æ–¥.", closed: "–û—á–µ—Ä–µ–¥—å –∑–∞–∫—Ä—ã—Ç–∞. –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 11:00‚Äì23:00." },
  uk: { title: "–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ —á–µ—Ä–≥–∏", name: "–Ü–º'—è / –ü—Ä—ñ–∑–≤–∏—Å—å–∫–æ:", code: "–ö–æ–¥ –∫–ª—É–±—É:", join: "–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è", pos: "–í–∞—à–∞ –ø–æ–∑–∏—Ü—ñ—è: ", refresh: "–û–Ω–æ–≤–∏—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é", error: "–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ –∫–æ–¥.", closed: "–ß–µ—Ä–≥–∞ –∑–∞–∫—Ä–∏—Ç–∞. –ì–æ–¥–∏–Ω–∏: 11:00‚Äì23:00." },
  fr: { title: "Rejoindre la file", name: "Nom / Surnom:", code: "Code du club:", join: "Rejoindre", pos: "Votre position: ", refresh: "Actualiser la position", error: "Veuillez entrer votre nom et code.", closed: "La file est ferm√©e. Horaires: 11:00‚Äì23:00." },
  it: { title: "Unisciti alla coda", name: "Nome / Soprannome:", code: "Codice del club:", join: "Unisciti alla coda", pos: "La tua posizione: ", refresh: "Aggiorna posizione", error: "Inserisci nome e codice.", closed: "La coda √® chiusa. Orario: 11:00‚Äì23:00." },
    };

    function setLanguage() {
      const lang = languageSelect.value;
      document.getElementById('title').innerText = texts[lang].title;
      document.getElementById('labelName').innerText = texts[lang].name;
      document.getElementById('labelCode').innerText = texts[lang].code;
      joinBtn.innerText = texts[lang].join;
      const refreshBtn = document.getElementById("refreshBtn");
      if (refreshBtn && texts[lang].refresh) refreshBtn.textContent = texts[lang].refresh;
      updatePosition();
    }
    languageSelect.addEventListener('change', setLanguage);
    setLanguage();

    function getDeviceId() {
      let id = localStorage.getItem('device_id');
      if (!id) {
        id = 'dev-' + Math.random().toString(36).substring(2, 12);
        localStorage.setItem('device_id', id);
      }
      return id;
    }

    async function checkStatus() {
      try {
        const resp = await fetch(`/api/status/${deviceId}`);
        const data = await resp.json();
        if (data.in_queue) showInQueueState(data.position);
        else resetFormState();
      } catch (err) { console.error("Status check failed:", err); }
    }

    function showInQueueState(position) {
      const lang = languageSelect.value;
      positionEl.innerText = texts[lang].pos + position;
      messageEl.innerText = '';
      joinBtn.disabled = true;
      nameInput.disabled = true;
      codeInput.disabled = true;
    }

    function resetFormState() {
      joinBtn.disabled = false;
      nameInput.disabled = false;
      codeInput.disabled = false;
      positionEl.innerText = '';
      messageEl.innerText = '';
    }

    async function updatePosition() {
      try {
        const resp = await fetch(`/api/status/${deviceId}`);
        const data = await resp.json();
        if (data.in_queue) showInQueueState(data.position);
        else resetFormState();
      } catch (err) { console.error("Update failed:", err); }
    }
    setInterval(updatePosition, 10000);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const code = codeInput.value.trim();
      const lang = languageSelect.value;

      if (!name || !code) {
        alert(texts[lang].error);
        return;
      }

      try {
        const resp = await fetch('/api/join', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ name, code, device_id: deviceId })
        });

        if (resp.status === 403) {
          alert(texts[lang].closed);
          return;
        }

        const data = await resp.json();
        if (data.error) {
          alert("Error: " + data.error);
          return;
        }

        showInQueueState(data.position);
        localStorage.setItem('name', name);
        localStorage.setItem('club_code', code);
      } catch (err) {
        console.error("Join error:", err);
      }
    });

    checkStatus();
  </script>



<script>
(function(){

// --- –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ---
function createModal(msg, okLabel){
  let old=document.getElementById("infoModal");
  if(old) old.remove();
  const modal=document.createElement("div");
  modal.id="infoModal";
  modal.innerHTML=`
  <div style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.35);z-index:1000;">
    <div style="background:#fff;border-radius:12px;max-width:300px;width:90%;
      padding:20px;box-shadow:0 4px 12px rgba(0,0,0,0.15);text-align:center;position:relative;">
      <button id='closeModal' style='position:absolute;top:8px;right:10px;
        border:none;background:none;font-size:20px;cursor:pointer;'>&times;</button>
      <p style='font-size:16px;margin:20px 0;'>${msg}</p>
      <button id='okModal' style='padding:8px 16px;background:#007aff;color:#fff;
        border:none;border-radius:8px;font-size:15px;cursor:pointer;'>${okLabel}</button>
    </div>
  </div>`;
  document.body.appendChild(modal);
  document.getElementById("closeModal").onclick=
  document.getElementById("okModal").onclick=()=>modal.remove();
}


}
})();
</script>




<script>
document.addEventListener("DOMContentLoaded", () => {
  const langSelect = document.getElementById("language");
  const savedLang = localStorage.getItem("lang");
  if (savedLang && langSelect) {
    langSelect.value = savedLang;
    if (typeof setLanguage === "function") setLanguage();
  }
  if (langSelect) {
    langSelect.addEventListener("change", () => {
      localStorage.setItem("lang", langSelect.value);
    });
  }
  // –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —è–∑—ã–∫–∞ –≤—ã–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–≤–æ–¥ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  if (typeof setLanguage === "function") {
    setLanguage();
  }
});
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const nameInput = document.getElementById("name");
  const codeInput = document.getElementById("club_code");

  // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã
  if (nameInput) {
    nameInput.addEventListener("input", () => {
      nameInput.value = [...nameInput.value]
        .filter(ch => /^[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]$/.test(ch))
        .join('');
    });
  }

  // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
  if (codeInput) {
    codeInput.addEventListener("input", () => {
      codeInput.value = codeInput.value.replace(/[^0-9]/g, '');
    });
  }
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const langSelect = document.getElementById("language");
  const savedLang = localStorage.getItem("lang");
  if (savedLang) langSelect.value = savedLang;
  function setLanguage() {
    const lang = langSelect.value;
    document.getElementById("title").innerText = texts[lang].title;
    document.getElementById("labelName").innerText = texts[lang].name;
    document.getElementById("labelCode").innerText = texts[lang].code;
    joinBtn.innerText = texts[lang].join;
    const refreshBtn = document.getElementById("refreshBtn");
    if (refreshBtn && texts[lang].refresh) refreshBtn.textContent = texts[lang].refresh;
  }
  langSelect.addEventListener("change", setLanguage);
  setLanguage();
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const langSelect = document.getElementById("language");
  const savedLang = localStorage.getItem("lang");
  if (savedLang && langSelect) langSelect.value = savedLang;
  function setLanguage() {
    const lang = langSelect.value;
    document.getElementById("title").innerText = texts[lang].title;
    document.getElementById("labelName").innerText = texts[lang].name;
    document.getElementById("labelCode").innerText = texts[lang].code;
    joinBtn.innerText = texts[lang].join;
    const refreshBtn = document.getElementById("refreshBtn");
    if (refreshBtn && texts[lang].refresh) refreshBtn.textContent = texts[lang].refresh;
  }
  langSelect.addEventListener("change", setLanguage);
  setLanguage();
  const refreshBtn = document.getElementById("refreshBtn");
  if (refreshBtn) {
    refreshBtn.addEventListener("click", () => {
      const lang = langSelect.value || en;
      const devId = localStorage.getItem("device_id");
      if (!devId) {
        createModal(texts[lang].notIn || "Please join first", texts[lang].ok || "OK");
        return;
      }
      location.reload();
    });
  }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const langSelect = document.getElementById("language");
  const savedLang = localStorage.getItem("lang");
  if (savedLang && langSelect) langSelect.value = savedLang;
  function setLanguage() {
    const lang = langSelect.value;
    document.getElementById("title").innerText = texts[lang].title;
    document.getElementById("labelName").innerText = texts[lang].name;
    document.getElementById("labelCode").innerText = texts[lang].code;
    joinBtn.innerText = texts[lang].join;
    const refreshBtn = document.getElementById("refreshBtn");
    if (refreshBtn) refreshBtn.textContent = texts[lang].refresh || "Refresh";
  }
  langSelect.addEventListener("change", setLanguage);
  setLanguage();
  const refreshBtn = document.getElementById("refreshBtn");
  if (refreshBtn) {
    refreshBtn.addEventListener("click", () => {
      const lang = langSelect.value || en;
      const devId = localStorage.getItem("device_id");
      if (!devId) {
        createModal(texts[lang].notIn || "Please join first", texts[lang].ok || "OK");
        return;
      }
      location.reload();
    });
  }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const langSelect = document.getElementById("language");
  const savedLang = localStorage.getItem("lang");
  if (savedLang && langSelect) langSelect.value = savedLang;
  function setLanguage() {
    const lang = langSelect.value;
    document.getElementById("title").innerText = texts[lang].title;
    document.getElementById("labelName").innerText = texts[lang].name;
    document.getElementById("labelCode").innerText = texts[lang].code;
    joinBtn.innerText = texts[lang].join;
    const refreshBtn = document.getElementById("refreshBtn");
    if (refreshBtn) refreshBtn.textContent = texts[lang].refresh || "Refresh";
  }
  langSelect.addEventListener("change", setLanguage);
  setLanguage();
  const refreshBtn = document.getElementById("refreshBtn");
  if (refreshBtn) {
    refreshBtn.addEventListener("click", () => {
      const lang = langSelect.value || "en";
      const devId = localStorage.getItem("device_id");
      if (!devId) {
        createModal(texts[lang].notIn || "Please join first", texts[lang].ok || "OK");
        return;
      }
      location.reload();
    });
  }
});
</script>
</body>



</html>

<!-- ==== –¢–£–¢ –ù–ê–ß–ò–ù–ê–ï–¢–°–Ø –ë–õ–û–ö –¢–ï–ú–´ ==== -->
<style>
  body.dark {
    background: #1c1c1c;
    color: #f0f0f0;
  }
  body.dark input, body.dark button, body.dark select {
    background: #333;
    color: #f0f0f0;
    border: 1px solid #666;
  }
</style>

<button id="themeToggle" style="position:fixed;top:10px;right:10px;font-size:14px;padding:6px 10px;width:auto;height:auto;">üåì</button>

<script>
  const themeToggle = document.getElementById('themeToggle');
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') document.body.classList.add('dark');

  themeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    const current = document.body.classList.contains('dark') ? 'dark' : 'light';
    localStorage.setItem('theme', current);
  });
</script>
<!-- ==== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –¢–ï–ú–´ ==== -->
